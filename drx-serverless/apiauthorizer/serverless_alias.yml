service: ${opt:project,"drx-apiauthorizer-lambda-alias"}

custom:
  vars: ${file(./variables.json)}
  logRetentionInDays: 30

provider:
  name: aws
  runtime: nodejs20.x
  region: ap-southeast-2
  vpc:
    securityGroupIds:
      - !Ref DRXLambdaSecurityGroup
    subnetIds: ${self:custom.vars.subnets}
  versionFunctions: true
  endpointType: regional
  stage: ${self:custom.vars.stage}
  deploymentBucket:
    name: cochlear-drx-${self:custom.vars.stage}-serverless-deploy # Deployment bucket name. Default is generated by the framework
    serverSideEncryption: AES256 # when using server-side encryption
  memorySize: 512
  timeout: 20
  logs:
    restApi: true
  stackTags:
    Owner: ${self:custom.vars.Owner}
    project: ${opt:project,"drx-apiauthorizer-lambda"}
    Resource: DRX
  tags:
    Description: ${self:custom.vars.Description}
    Name: 'drx-apiauthorizer-lambda'
    Function: 'Serverless'
    Environment: ${self:custom.vars.Environment}
    Product: ${self:custom.vars.Product}

package: # Optional deployment packaging configuration
  individually: true
  include: # Specify the directories and files which should be included in the deployment package
    - src/**
      ## Resources ##
resources:
  Resources:
    MyAlias:
      Type: AWS::Lambda::Alias
      Properties:
        FunctionName: cochlear-drx-apiauthorizer-${self:custom.vars.stage}
        FunctionVersion: ${opt:LATESTVERSION}
        Name: ${self:custom.vars.releaseVersion}
  Outputs:
    MyAliasOutput:
      Description: 'Output'
      Value:
        Ref: MyAlias
